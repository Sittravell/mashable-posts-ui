{"ast":null,"code":"import{useCallback,useEffect,useState}from\"react\";import{CanceledError}from\"axios\";import{Post}from\"../+requests\";export function usePostsRetriever(_ref){let{page}=_ref;const[list,setList]=useState([]);const[isListError,setIsListError]=useState(false);const[isListLoading,setIsListLoading]=useState(false);const[isInitialized,setIsInitialized]=useState(false);const[isLastPage,setIsLastPage]=useState(false);const getList=useCallback(async abortSignal=>{if(isLastPage){return;}setIsListLoading(true);setIsListError(false);try{const res=await Post.getList({page,itemsPerPage:35},abortSignal);const newList=res.data.data;if(newList.length===0){setIsLastPage(true);}setList(list=>[...list,...newList]);}catch(error){if(!(error instanceof CanceledError)){setIsListError(true);}}finally{setIsListLoading(false);setIsInitialized(true);}},[isLastPage,page]);useEffect(()=>{const ac=new AbortController();void getList(ac.signal);return()=>{ac.abort();};},[getList]);return{list,isListInitialized:isInitialized,isListError,isListLoading,fetchList:getList};}","map":{"version":3,"names":["useCallback","useEffect","useState","CanceledError","Post","usePostsRetriever","_ref","page","list","setList","isListError","setIsListError","isListLoading","setIsListLoading","isInitialized","setIsInitialized","isLastPage","setIsLastPage","getList","abortSignal","res","itemsPerPage","newList","data","length","error","ac","AbortController","signal","abort","isListInitialized","fetchList"],"sources":["/Users/sivanthisittravell/Downloads/mashable-posts-ui/src/app/posts/use-posts-retriever.ts"],"sourcesContent":["import {useCallback, useEffect, useState} from \"react\";\nimport {CanceledError, GenericAbortSignal} from \"axios\";\nimport {Post, PostItem, PostListResponseModel} from \"../+requests\";\n\ninterface Props {\n    page: number;\n}\n\nexport function usePostsRetriever({\n    page\n}: Props) {\n    const [list, setList] = useState<PostItem[]>([])\n    const [isListError, setIsListError] = useState(false)\n    const [isListLoading, setIsListLoading] = useState(false)\n    const [isInitialized, setIsInitialized] = useState(false)\n    const [isLastPage, setIsLastPage] = useState(false)\n\n    const getList = useCallback(async (abortSignal: GenericAbortSignal) => {\n        if (isLastPage) {\n            return;\n        }\n\n        setIsListLoading(true)\n        setIsListError(false)\n        try {\n            const res: PostListResponseModel = await Post.getList({page, itemsPerPage: 35}, abortSignal)\n            const newList = res.data.data\n\n            if (newList.length === 0) {\n                setIsLastPage(true)\n            }\n\n            setList(list => [...list, ...newList])\n        } catch (error) {\n            if (!(error instanceof CanceledError)) {\n                setIsListError(true)\n            }\n        } finally {\n            setIsListLoading(false)\n            setIsInitialized(true)\n        }\n\n    }, [isLastPage, page]);\n\n    useEffect(() => {\n        const ac = new AbortController()\n        void getList(ac.signal)\n\n        return () => {\n            ac.abort()\n        }\n    }, [getList]);\n\n    return {\n        list,\n        isListInitialized: isInitialized,\n        isListError,\n        isListLoading,\n        fetchList: getList,\n    }\n}\n"],"mappings":"AAAA,OAAQA,WAAW,CAAEC,SAAS,CAAEC,QAAQ,KAAO,OAAO,CACtD,OAAQC,aAAa,KAA2B,OAAO,CACvD,OAAQC,IAAI,KAAwC,cAAc,CAMlE,MAAO,SAAS,CAAAC,iBAAiBA,CAAAC,IAAA,CAEvB,IAFwB,CAC9BC,IACG,CAAC,CAAAD,IAAA,CACJ,KAAM,CAACE,IAAI,CAAEC,OAAO,CAAC,CAAGP,QAAQ,CAAa,EAAE,CAAC,CAChD,KAAM,CAACQ,WAAW,CAAEC,cAAc,CAAC,CAAGT,QAAQ,CAAC,KAAK,CAAC,CACrD,KAAM,CAACU,aAAa,CAAEC,gBAAgB,CAAC,CAAGX,QAAQ,CAAC,KAAK,CAAC,CACzD,KAAM,CAACY,aAAa,CAAEC,gBAAgB,CAAC,CAAGb,QAAQ,CAAC,KAAK,CAAC,CACzD,KAAM,CAACc,UAAU,CAAEC,aAAa,CAAC,CAAGf,QAAQ,CAAC,KAAK,CAAC,CAEnD,KAAM,CAAAgB,OAAO,CAAGlB,WAAW,CAAC,KAAO,CAAAmB,WAA+B,EAAK,CACnE,GAAIH,UAAU,CAAE,CACZ,OACJ,CAEAH,gBAAgB,CAAC,IAAI,CAAC,CACtBF,cAAc,CAAC,KAAK,CAAC,CACrB,GAAI,CACA,KAAM,CAAAS,GAA0B,CAAG,KAAM,CAAAhB,IAAI,CAACc,OAAO,CAAC,CAACX,IAAI,CAAEc,YAAY,CAAE,EAAE,CAAC,CAAEF,WAAW,CAAC,CAC5F,KAAM,CAAAG,OAAO,CAAGF,GAAG,CAACG,IAAI,CAACA,IAAI,CAE7B,GAAID,OAAO,CAACE,MAAM,GAAK,CAAC,CAAE,CACtBP,aAAa,CAAC,IAAI,CAAC,CACvB,CAEAR,OAAO,CAACD,IAAI,EAAI,CAAC,GAAGA,IAAI,CAAE,GAAGc,OAAO,CAAC,CAAC,CAC1C,CAAE,MAAOG,KAAK,CAAE,CACZ,GAAI,EAAEA,KAAK,WAAY,CAAAtB,aAAa,CAAC,CAAE,CACnCQ,cAAc,CAAC,IAAI,CAAC,CACxB,CACJ,CAAC,OAAS,CACNE,gBAAgB,CAAC,KAAK,CAAC,CACvBE,gBAAgB,CAAC,IAAI,CAAC,CAC1B,CAEJ,CAAC,CAAE,CAACC,UAAU,CAAET,IAAI,CAAC,CAAC,CAEtBN,SAAS,CAAC,IAAM,CACZ,KAAM,CAAAyB,EAAE,CAAG,GAAI,CAAAC,eAAe,CAAC,CAAC,CAChC,IAAK,CAAAT,OAAO,CAACQ,EAAE,CAACE,MAAM,CAAC,CAEvB,MAAO,IAAM,CACTF,EAAE,CAACG,KAAK,CAAC,CAAC,CACd,CAAC,CACL,CAAC,CAAE,CAACX,OAAO,CAAC,CAAC,CAEb,MAAO,CACHV,IAAI,CACJsB,iBAAiB,CAAEhB,aAAa,CAChCJ,WAAW,CACXE,aAAa,CACbmB,SAAS,CAAEb,OACf,CAAC,CACL","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}