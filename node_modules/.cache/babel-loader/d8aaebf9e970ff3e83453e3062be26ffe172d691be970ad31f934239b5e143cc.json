{"ast":null,"code":"import{useCallback,useEffect,useState}from\"react\";import{CanceledError}from\"axios\";import{Post}from\"../+requests\";import moment from\"moment/moment\";export function usePostsRetriever(_ref){let{page,startDate}=_ref;const[list,setList]=useState([]);const[isListError,setIsListError]=useState(false);const[isListLoading,setIsListLoading]=useState(false);const[isInitialized,setIsInitialized]=useState(false);const[isLastPage,setIsLastPage]=useState(false);const getList=useCallback(async abortSignal=>{if(isLastPage){return;}setIsListLoading(true);setIsListError(false);try{const res=await Post.getList({page,items_per_page:35,end_date:moment().toISOString(),start_date:startDate},abortSignal);const newList=res.data.data;if(newList.length===0){setIsLastPage(true);}setList(list=>[...list,...newList]);}catch(error){if(!(error instanceof CanceledError)){setIsListError(true);}}finally{setIsListLoading(false);setIsInitialized(true);}},[isLastPage,page,startDate]);useEffect(()=>{const ac=new AbortController();void getList(ac.signal);return()=>{ac.abort();};},[getList]);return{list,isListInitialized:isInitialized,isListError,isListLoading,fetchList:getList};}","map":{"version":3,"names":["useCallback","useEffect","useState","CanceledError","Post","moment","usePostsRetriever","_ref","page","startDate","list","setList","isListError","setIsListError","isListLoading","setIsListLoading","isInitialized","setIsInitialized","isLastPage","setIsLastPage","getList","abortSignal","res","items_per_page","end_date","toISOString","start_date","newList","data","length","error","ac","AbortController","signal","abort","isListInitialized","fetchList"],"sources":["/Users/sivanthisittravell/Downloads/mashable-posts-ui/src/app/posts/use-posts-retriever.ts"],"sourcesContent":["import {useCallback, useEffect, useState} from \"react\";\nimport {CanceledError, GenericAbortSignal} from \"axios\";\nimport {Post, PostItem, PostListResponseModel} from \"../+requests\";\nimport moment from \"moment/moment\";\n\ninterface Props {\n    page: number;\n    startDate: string;\n}\n\nexport function usePostsRetriever({\n    page,\n    startDate\n}: Props) {\n    const [list, setList] = useState<PostItem[]>([])\n    const [isListError, setIsListError] = useState(false)\n    const [isListLoading, setIsListLoading] = useState(false)\n    const [isInitialized, setIsInitialized] = useState(false)\n    const [isLastPage, setIsLastPage] = useState(false)\n\n    const getList = useCallback(async (abortSignal?: GenericAbortSignal) => {\n        if (isLastPage) {\n            return;\n        }\n\n        setIsListLoading(true)\n        setIsListError(false)\n\n        try {\n            const res: PostListResponseModel = await Post.getList(\n                {\n                    page,\n                    items_per_page: 35,\n                    end_date: moment().toISOString(),\n                    start_date: startDate,\n                },\n                abortSignal\n            )\n\n            const newList = res.data.data\n\n            if (newList.length === 0) {\n                setIsLastPage(true)\n            }\n\n            setList(list => [...list, ...newList])\n        } catch (error) {\n            if (!(error instanceof CanceledError)) {\n                setIsListError(true)\n            }\n        } finally {\n            setIsListLoading(false)\n            setIsInitialized(true)\n        }\n\n    }, [isLastPage, page, startDate]);\n\n    useEffect(() => {\n        const ac = new AbortController()\n        void getList(ac.signal)\n\n        return () => {\n            ac.abort()\n        }\n    }, [getList]);\n\n    return {\n        list,\n        isListInitialized: isInitialized,\n        isListError,\n        isListLoading,\n        fetchList: getList,\n    }\n}\n"],"mappings":"AAAA,OAAQA,WAAW,CAAEC,SAAS,CAAEC,QAAQ,KAAO,OAAO,CACtD,OAAQC,aAAa,KAA2B,OAAO,CACvD,OAAQC,IAAI,KAAwC,cAAc,CAClE,MAAO,CAAAC,MAAM,KAAM,eAAe,CAOlC,MAAO,SAAS,CAAAC,iBAAiBA,CAAAC,IAAA,CAGvB,IAHwB,CAC9BC,IAAI,CACJC,SACG,CAAC,CAAAF,IAAA,CACJ,KAAM,CAACG,IAAI,CAAEC,OAAO,CAAC,CAAGT,QAAQ,CAAa,EAAE,CAAC,CAChD,KAAM,CAACU,WAAW,CAAEC,cAAc,CAAC,CAAGX,QAAQ,CAAC,KAAK,CAAC,CACrD,KAAM,CAACY,aAAa,CAAEC,gBAAgB,CAAC,CAAGb,QAAQ,CAAC,KAAK,CAAC,CACzD,KAAM,CAACc,aAAa,CAAEC,gBAAgB,CAAC,CAAGf,QAAQ,CAAC,KAAK,CAAC,CACzD,KAAM,CAACgB,UAAU,CAAEC,aAAa,CAAC,CAAGjB,QAAQ,CAAC,KAAK,CAAC,CAEnD,KAAM,CAAAkB,OAAO,CAAGpB,WAAW,CAAC,KAAO,CAAAqB,WAAgC,EAAK,CACpE,GAAIH,UAAU,CAAE,CACZ,OACJ,CAEAH,gBAAgB,CAAC,IAAI,CAAC,CACtBF,cAAc,CAAC,KAAK,CAAC,CAErB,GAAI,CACA,KAAM,CAAAS,GAA0B,CAAG,KAAM,CAAAlB,IAAI,CAACgB,OAAO,CACjD,CACIZ,IAAI,CACJe,cAAc,CAAE,EAAE,CAClBC,QAAQ,CAAEnB,MAAM,CAAC,CAAC,CAACoB,WAAW,CAAC,CAAC,CAChCC,UAAU,CAAEjB,SAChB,CAAC,CACDY,WACJ,CAAC,CAED,KAAM,CAAAM,OAAO,CAAGL,GAAG,CAACM,IAAI,CAACA,IAAI,CAE7B,GAAID,OAAO,CAACE,MAAM,GAAK,CAAC,CAAE,CACtBV,aAAa,CAAC,IAAI,CAAC,CACvB,CAEAR,OAAO,CAACD,IAAI,EAAI,CAAC,GAAGA,IAAI,CAAE,GAAGiB,OAAO,CAAC,CAAC,CAC1C,CAAE,MAAOG,KAAK,CAAE,CACZ,GAAI,EAAEA,KAAK,WAAY,CAAA3B,aAAa,CAAC,CAAE,CACnCU,cAAc,CAAC,IAAI,CAAC,CACxB,CACJ,CAAC,OAAS,CACNE,gBAAgB,CAAC,KAAK,CAAC,CACvBE,gBAAgB,CAAC,IAAI,CAAC,CAC1B,CAEJ,CAAC,CAAE,CAACC,UAAU,CAAEV,IAAI,CAAEC,SAAS,CAAC,CAAC,CAEjCR,SAAS,CAAC,IAAM,CACZ,KAAM,CAAA8B,EAAE,CAAG,GAAI,CAAAC,eAAe,CAAC,CAAC,CAChC,IAAK,CAAAZ,OAAO,CAACW,EAAE,CAACE,MAAM,CAAC,CAEvB,MAAO,IAAM,CACTF,EAAE,CAACG,KAAK,CAAC,CAAC,CACd,CAAC,CACL,CAAC,CAAE,CAACd,OAAO,CAAC,CAAC,CAEb,MAAO,CACHV,IAAI,CACJyB,iBAAiB,CAAEnB,aAAa,CAChCJ,WAAW,CACXE,aAAa,CACbsB,SAAS,CAAEhB,OACf,CAAC,CACL","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}